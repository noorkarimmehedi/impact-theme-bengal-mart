{% comment %}
  Offer Cards Carousel Snippet
  Usage: {% render 'offer-cards-carousel' %}
{% endcomment %}

{% assign ai_gen_id = 'offercarousel' %}

{% style %}
  .ai-offer-cards-{{ ai_gen_id }} {
    width: 100%;
    padding: 20px 0;
  }

  .ai-offer-cards__title-{{ ai_gen_id }} {
    text-align: center;
    font-size: 28px;
    color: #000000;
    margin: 0 0 24px 0;
  }

  .ai-offer-cards__carousel-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    width: 100%;
    padding: 0 16px;
  }

  .ai-offer-cards__track-{{ ai_gen_id }} {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: 8px 0;
  }

  .ai-offer-cards__track-{{ ai_gen_id }}::-webkit-scrollbar {
    display: none;
  }

  .ai-offer-card-{{ ai_gen_id }} {
    flex: 0 0 240px;
    scroll-snap-align: center;
    background: #fff9f0;
    border: 2px dashed #ff8c00;
    border-radius: 12px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
  }

  .ai-offer-card__discount-{{ ai_gen_id }} {
    font-size: 15px;
    font-weight: 600;
    color: #d35400;
    margin: 0;
  }

  .ai-offer-card__code-wrapper-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #ffffff;
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #e0e0e0;
  }

  .ai-offer-card__code-{{ ai_gen_id }} {
    flex: 1;
    font-size: 16px;
    font-weight: 700;
    color: #000000;
    margin: 0;
    letter-spacing: 1px;
  }

  .ai-offer-card__copy-btn-{{ ai_gen_id }} {
    background: #ff8c00;
    color: #ffffff;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .ai-offer-card__copy-btn-{{ ai_gen_id }}:hover {
    background: #e67e00;
  }

  .ai-offer-card__copy-btn-{{ ai_gen_id }}.copied {
    background: #00a341;
  }

  .ai-offer-card__description-{{ ai_gen_id }} {
    font-size: 12px;
    color: #666666;
    margin: 0;
    line-height: 1.4;
  }

  .ai-offer-cards__indicators-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 16px;
  }

  .ai-offer-cards__indicator-{{ ai_gen_id }} {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #ff8c00;
    opacity: 0.3;
    transition: opacity 0.3s ease;
    cursor: pointer;
    border: none;
    padding: 0;
  }

  .ai-offer-cards__indicator-{{ ai_gen_id }}.active {
    opacity: 1;
  }

  @media screen and (min-width: 750px) {
    .ai-offer-cards__carousel-{{ ai_gen_id }} {
      padding: 0 40px;
    }

    .ai-offer-cards__track-{{ ai_gen_id }} {
      justify-content: center;
      gap: 20px;
    }

    .ai-offer-card-{{ ai_gen_id }} {
      flex: 0 0 280px;
      padding: 18px;
    }
  }

  @media screen and (min-width: 990px) {
    .ai-offer-cards__track-{{ ai_gen_id }} {
      gap: 24px;
    }

    .ai-offer-card-{{ ai_gen_id }} {
      flex: 0 0 300px;
    }
  }
{% endstyle %}

<div class="ai-offer-cards-{{ ai_gen_id }}">
  <h2 class="ai-offer-cards__title-{{ ai_gen_id }}">Special Offers</h2>

  <div class="ai-offer-cards__carousel-{{ ai_gen_id }}">
    <div class="ai-offer-cards__track-{{ ai_gen_id }}" data-track>
      <div class="ai-offer-card-{{ ai_gen_id }}" data-card>
        <p class="ai-offer-card__discount-{{ ai_gen_id }}">Get 20% OFF</p>
        <div class="ai-offer-card__code-wrapper-{{ ai_gen_id }}">
          <p class="ai-offer-card__code-{{ ai_gen_id }}">SAVE20</p>
          <button class="ai-offer-card__copy-btn-{{ ai_gen_id }}" data-code="SAVE20" aria-label="Copy coupon code SAVE20">
            Copy
          </button>
        </div>
        <p class="ai-offer-card__description-{{ ai_gen_id }}">Valid on orders above ৳500. Limited time offer!</p>
      </div>

      <div class="ai-offer-card-{{ ai_gen_id }}" data-card>
        <p class="ai-offer-card__discount-{{ ai_gen_id }}">Flat ৳100 OFF</p>
        <div class="ai-offer-card__code-wrapper-{{ ai_gen_id }}">
          <p class="ai-offer-card__code-{{ ai_gen_id }}">FLAT100</p>
          <button class="ai-offer-card__copy-btn-{{ ai_gen_id }}" data-code="FLAT100" aria-label="Copy coupon code FLAT100">
            Copy
          </button>
        </div>
        <p class="ai-offer-card__description-{{ ai_gen_id }}">On your first purchase. New customers only.</p>
      </div>

      <div class="ai-offer-card-{{ ai_gen_id }}" data-card>
        <p class="ai-offer-card__discount-{{ ai_gen_id }}">Buy 2 Get 1 Free</p>
        <div class="ai-offer-card__code-wrapper-{{ ai_gen_id }}">
          <p class="ai-offer-card__code-{{ ai_gen_id }}">BUY2GET1</p>
          <button class="ai-offer-card__copy-btn-{{ ai_gen_id }}" data-code="BUY2GET1" aria-label="Copy coupon code BUY2GET1">
            Copy
          </button>
        </div>
        <p class="ai-offer-card__description-{{ ai_gen_id }}">Applicable on selected items. Check product page.</p>
      </div>
    </div>
  </div>

  <div class="ai-offer-cards__indicators-{{ ai_gen_id }}" data-indicators></div>
</div>

<script>
  (function() {
    if (customElements.get('offer-cards-{{ ai_gen_id }}')) return;

    class OfferCardsCarousel extends HTMLElement {
      constructor() {
        super();
        this.track = this.querySelector('[data-track]');
        this.cards = this.querySelectorAll('[data-card]');
        this.indicatorsContainer = this.querySelector('[data-indicators]');
        this.currentIndex = 0;
      }

      connectedCallback() {
        this.createIndicators();
        this.setupCopyButtons();
        this.setupScrollListener();
        setTimeout(() => this.centerFirstCard(), 100);
      }

      centerFirstCard() {
        if (this.cards.length > 0 && window.innerWidth < 750) {
          const firstCard = this.cards[0];
          const trackWidth = this.track.offsetWidth;
          const cardWidth = firstCard.offsetWidth;
          const scrollPosition = firstCard.offsetLeft - (trackWidth / 2) + (cardWidth / 2);
          this.track.scrollLeft = scrollPosition;
        }
      }

      createIndicators() {
        if (this.cards.length <= 1) return;

        this.cards.forEach((card, index) => {
          const indicator = document.createElement('button');
          indicator.className = 'ai-offer-cards__indicator-{{ ai_gen_id }}';
          indicator.setAttribute('aria-label', `Go to offer ${index + 1}`);
          if (index === 0) indicator.classList.add('active');

          indicator.addEventListener('click', () => {
            this.scrollToCard(index);
          });

          this.indicatorsContainer.appendChild(indicator);
        });
      }

      scrollToCard(index) {
        const card = this.cards[index];
        if (!card) return;

        const trackWidth = this.track.offsetWidth;
        const cardWidth = card.offsetWidth;
        const scrollPosition = card.offsetLeft - (trackWidth / 2) + (cardWidth / 2);

        this.track.scrollTo({
          left: scrollPosition,
          behavior: 'smooth'
        });
      }

      setupScrollListener() {
        this.track.addEventListener('scroll', () => {
          this.updateActiveIndicator();
        });
      }

      updateActiveIndicator() {
        const trackCenter = this.track.scrollLeft + (this.track.offsetWidth / 2);
        let closestIndex = 0;
        let closestDistance = Infinity;

        this.cards.forEach((card, index) => {
          const cardCenter = card.offsetLeft + (card.offsetWidth / 2);
          const distance = Math.abs(trackCenter - cardCenter);

          if (distance < closestDistance) {
            closestDistance = distance;
            closestIndex = index;
          }
        });

        const indicators = this.indicatorsContainer.querySelectorAll('.ai-offer-cards__indicator-{{ ai_gen_id }}');
        indicators.forEach((indicator, index) => {
          indicator.classList.toggle('active', index === closestIndex);
        });

        this.currentIndex = closestIndex;
      }

      setupCopyButtons() {
        const copyButtons = this.querySelectorAll('.ai-offer-card__copy-btn-{{ ai_gen_id }}');

        copyButtons.forEach(button => {
          button.addEventListener('click', async () => {
            const code = button.getAttribute('data-code');
            const originalText = button.textContent;

            try {
              await navigator.clipboard.writeText(code);
              button.textContent = 'Copied!';
              button.classList.add('copied');

              setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
              }, 2000);
            } catch (err) {
              const textArea = document.createElement('textarea');
              textArea.value = code;
              textArea.style.position = 'fixed';
              textArea.style.opacity = '0';
              document.body.appendChild(textArea);
              textArea.select();
              document.execCommand('copy');
              document.body.removeChild(textArea);

              button.textContent = 'Copied!';
              button.classList.add('copied');

              setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
              }, 2000);
            }
          });
        });
      }
    }

    customElements.define('offer-cards-{{ ai_gen_id }}', OfferCardsCarousel);
  })();
</script>