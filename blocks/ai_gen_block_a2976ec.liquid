{% doc %}
  @prompt
    Redesigned offer cards with ticket/coupon style featuring notched circular cutouts on sides, cleaner layout with main heading and subheading, smaller card sizes, centered first card on mobile, customizable title spacing and shadow options.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-offer-cards-{{ ai_gen_id }} {
    width: 100%;
    padding: 20px 0;
  }

  .ai-offer-cards__title-{{ ai_gen_id }} {
    text-align: center;
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    font-weight: 700;
    margin: 0 0 {{ block.settings.title_spacing }}px 0;
  }

  .ai-offer-cards__carousel-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    width: 100%;
    padding: 0 16px;
  }

  .ai-offer-cards__track-{{ ai_gen_id }} {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: 20px 0;
  }

  .ai-offer-cards__track-{{ ai_gen_id }}::-webkit-scrollbar {
    display: none;
  }

  .ai-offer-card-{{ ai_gen_id }} {
    flex: 0 0 180px;
    scroll-snap-align: center;
    background: {{ block.settings.card_background }};
    border: 2px solid {{ block.settings.border_color }};
    border-radius: {{ block.settings.card_border_radius }}px;
    padding: 16px 14px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    position: relative;
    box-shadow: {{ block.settings.shadow_horizontal }}px {{ block.settings.shadow_vertical }}px {{ block.settings.shadow_blur }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 }});
  }

  /* Ticket notches */
  .ai-offer-card-{{ ai_gen_id }}::before,
  .ai-offer-card-{{ ai_gen_id }}::after {
    content: '';
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    background: {{ block.settings.notch_background }};
    border-radius: 50%;
    border: 2px solid {{ block.settings.border_color }};
  }

  .ai-offer-card-{{ ai_gen_id }}::before {
    left: -9px;
    border-right: none;
  }

  .ai-offer-card-{{ ai_gen_id }}::after {
    right: -9px;
    border-left: none;
  }

  .ai-offer-card__heading-{{ ai_gen_id }} {
    font-size: 15px;
    font-weight: 700;
    color: {{ block.settings.heading_color }};
    margin: 0;
    line-height: 1.3;
  }

  .ai-offer-card__subheading-{{ ai_gen_id }} {
    font-size: 12px;
    color: {{ block.settings.subheading_color }};
    margin: 0;
    line-height: 1.4;
  }

  .ai-offer-card__subheading-{{ ai_gen_id }} a {
    color: {{ block.settings.link_color }};
    text-decoration: underline;
    font-weight: 500;
  }

  .ai-offer-card__code-wrapper-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 6px;
    background: {{ block.settings.code_background }};
    padding: 6px 8px;
    border-radius: 4px;
    border: 1px dashed {{ block.settings.code_border_color }};
    margin-top: 4px;
  }

  .ai-offer-card__code-{{ ai_gen_id }} {
    flex: 1;
    font-size: 13px;
    font-weight: 700;
    color: {{ block.settings.code_color }};
    margin: 0;
    letter-spacing: 0.5px;
  }

  .ai-offer-card__copy-btn-{{ ai_gen_id }} {
    background: {{ block.settings.copy_button_bg }};
    color: {{ block.settings.copy_button_color }};
    border: none;
    padding: 4px 10px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    text-transform: uppercase;
  }

  .ai-offer-card__copy-btn-{{ ai_gen_id }}:hover {
    background: {{ block.settings.copy_button_hover_bg }};
  }

  .ai-offer-card__copy-btn-{{ ai_gen_id }}.copied {
    background: {{ block.settings.success_color }};
  }

  .ai-offer-card__description-{{ ai_gen_id }} {
    font-size: 11px;
    color: {{ block.settings.description_color }};
    margin: 2px 0 0 0;
    line-height: 1.3;
  }

  .ai-offer-cards__indicators-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 16px;
  }

  .ai-offer-cards__indicator-{{ ai_gen_id }} {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: {{ block.settings.indicator_color }};
    opacity: 0.3;
    transition: opacity 0.3s ease;
    cursor: pointer;
    border: none;
    padding: 0;
  }

  .ai-offer-cards__indicator-{{ ai_gen_id }}.active {
    opacity: 1;
  }

  @media screen and (min-width: 749px) {
    .ai-offer-cards__carousel-{{ ai_gen_id }} {
      padding: 0 40px;
    }

    .ai-offer-cards__track-{{ ai_gen_id }} {
      justify-content: center;
      gap: 20px;
    }

    .ai-offer-card-{{ ai_gen_id }} {
      flex: 0 0 220px;
    }
  }

  @media screen and (min-width: 990px) {
    .ai-offer-cards__track-{{ ai_gen_id }} {
      gap: 24px;
    }

    .ai-offer-card-{{ ai_gen_id }} {
      flex: 0 0 240px;
    }
  }
{% endstyle %}

<offer-cards-{{ ai_gen_id }} class="ai-offer-cards-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  {% if block.settings.title != blank %}
    <h2 class="ai-offer-cards__title-{{ ai_gen_id }}">{{ block.settings.title }}</h2>
  {% endif %}

  <div class="ai-offer-cards__carousel-{{ ai_gen_id }}">
    <div class="ai-offer-cards__track-{{ ai_gen_id }}" data-track>
      {% for i in (1..5) %}
        {% liquid
          assign heading_key = 'heading_' | append: i
          assign subheading_key = 'subheading_' | append: i
          assign code_key = 'code_' | append: i
          assign description_key = 'description_' | append: i
          assign enabled_key = 'card_' | append: i | append: '_enabled'

          assign heading = block.settings[heading_key]
          assign subheading = block.settings[subheading_key]
          assign code = block.settings[code_key]
          assign description = block.settings[description_key]
          assign enabled = block.settings[enabled_key]
        %}

        {% if enabled and code != blank %}
          <div class="ai-offer-card-{{ ai_gen_id }}" data-card>
            {% if heading != blank %}
              <h3 class="ai-offer-card__heading-{{ ai_gen_id }}">{{ heading }}</h3>
            {% endif %}

            {% if subheading != blank %}
              <p class="ai-offer-card__subheading-{{ ai_gen_id }}">{{ subheading }}</p>
            {% endif %}

            <div class="ai-offer-card__code-wrapper-{{ ai_gen_id }}">
              <p class="ai-offer-card__code-{{ ai_gen_id }}">{{ code }}</p>
              <button
                class="ai-offer-card__copy-btn-{{ ai_gen_id }}"
                data-code="{{ code }}"
                aria-label="Copy coupon code {{ code }}"
              >
                {{ block.settings.copy_button_text }}
              </button>
            </div>

            {% if description != blank %}
              <p class="ai-offer-card__description-{{ ai_gen_id }}">{{ description }}</p>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <div class="ai-offer-cards__indicators-{{ ai_gen_id }}" data-indicators></div>
</offer-cards-{{ ai_gen_id }}>

<script>
  (function() {
    class OfferCards{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.track = this.querySelector('[data-track]');
        this.cards = this.querySelectorAll('[data-card]');
        this.indicatorsContainer = this.querySelector('[data-indicators]');
        this.currentIndex = 0;
      }

      connectedCallback() {
        this.createIndicators();
        this.setupCopyButtons();
        this.setupScrollListener();
        this.centerFirstCard();
      }

      centerFirstCard() {
        if (this.cards.length > 0 && window.innerWidth < 750) {
          const firstCard = this.cards[0];
          const trackWidth = this.track.offsetWidth;
          const cardWidth = firstCard.offsetWidth;
          const scrollPosition = firstCard.offsetLeft - (trackWidth / 2) + (cardWidth / 2);
          this.track.scrollLeft = scrollPosition;
        }
      }

      createIndicators() {
        if (this.cards.length <= 1) return;

        this.cards.forEach((card, index) => {
          const indicator = document.createElement('button');
          indicator.className = 'ai-offer-cards__indicator-{{ ai_gen_id }}';
          indicator.setAttribute('aria-label', `Go to offer ${index + 1}`);
          if (index === 0) indicator.classList.add('active');

          indicator.addEventListener('click', () => {
            this.scrollToCard(index);
          });

          this.indicatorsContainer.appendChild(indicator);
        });
      }

      scrollToCard(index) {
        const card = this.cards[index];
        if (!card) return;

        const trackWidth = this.track.offsetWidth;
        const cardWidth = card.offsetWidth;
        const scrollPosition = card.offsetLeft - (trackWidth / 2) + (cardWidth / 2);

        this.track.scrollTo({
          left: scrollPosition,
          behavior: 'smooth'
        });
      }

      setupScrollListener() {
        this.track.addEventListener('scroll', () => {
          this.updateActiveIndicator();
        });
      }

      updateActiveIndicator() {
        const trackCenter = this.track.scrollLeft + (this.track.offsetWidth / 2);
        let closestIndex = 0;
        let closestDistance = Infinity;

        this.cards.forEach((card, index) => {
          const cardCenter = card.offsetLeft + (card.offsetWidth / 2);
          const distance = Math.abs(trackCenter - cardCenter);

          if (distance < closestDistance) {
            closestDistance = distance;
            closestIndex = index;
          }
        });

        const indicators = this.indicatorsContainer.querySelectorAll('.ai-offer-cards__indicator-{{ ai_gen_id }}');
        indicators.forEach((indicator, index) => {
          indicator.classList.toggle('active', index === closestIndex);
        });

        this.currentIndex = closestIndex;
      }

      setupCopyButtons() {
        const copyButtons = this.querySelectorAll('.ai-offer-card__copy-btn-{{ ai_gen_id }}');

        copyButtons.forEach(button => {
          button.addEventListener('click', async () => {
            const code = button.getAttribute('data-code');
            const originalText = button.textContent;

            try {
              await navigator.clipboard.writeText(code);
              button.textContent = '{{ block.settings.copied_text }}';
              button.classList.add('copied');

              setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
              }, 2000);
            } catch (err) {
              const textArea = document.createElement('textarea');
              textArea.value = code;
              textArea.style.position = 'fixed';
              textArea.style.opacity = '0';
              document.body.appendChild(textArea);
              textArea.select();
              document.execCommand('copy');
              document.body.removeChild(textArea);

              button.textContent = '{{ block.settings.copied_text }}';
              button.classList.add('copied');

              setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
              }, 2000);
            }
          });
        });
      }
    }

    customElements.define('offer-cards-{{ ai_gen_id }}', OfferCards{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Ticket Offer Cards",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Title"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Available Offers"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 28
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_spacing",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Space below title",
      "default": 24
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "notch_background",
      "label": "Notch background (should match page background)",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#ff8c00"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 12
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "subheading_color",
      "label": "Subheading color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link color",
      "default": "#0066cc"
    },
    {
      "type": "header",
      "content": "Card shadow"
    },
    {
      "type": "range",
      "id": "shadow_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Opacity",
      "default": 10
    },
    {
      "type": "range",
      "id": "shadow_horizontal",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Horizontal offset",
      "default": 0
    },
    {
      "type": "range",
      "id": "shadow_vertical",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Vertical offset",
      "default": 2
    },
    {
      "type": "range",
      "id": "shadow_blur",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Blur",
      "default": 8
    },
    {
      "type": "header",
      "content": "Coupon code"
    },
    {
      "type": "color",
      "id": "code_background",
      "label": "Code background",
      "default": "#fffbf5"
    },
    {
      "type": "color",
      "id": "code_border_color",
      "label": "Code border color",
      "default": "#ff8c00"
    },
    {
      "type": "color",
      "id": "code_color",
      "label": "Code text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Copy button"
    },
    {
      "type": "text",
      "id": "copy_button_text",
      "label": "Button text",
      "default": "Copy"
    },
    {
      "type": "text",
      "id": "copied_text",
      "label": "Copied text",
      "default": "Copied!"
    },
    {
      "type": "color",
      "id": "copy_button_bg",
      "label": "Button background",
      "default": "#ff8c00"
    },
    {
      "type": "color",
      "id": "copy_button_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "copy_button_hover_bg",
      "label": "Button hover background",
      "default": "#e67e00"
    },
    {
      "type": "color",
      "id": "success_color",
      "label": "Success color",
      "default": "#00a341"
    },
    {
      "type": "header",
      "content": "Indicators"
    },
    {
      "type": "color",
      "id": "indicator_color",
      "label": "Indicator color",
      "default": "#ff8c00"
    },
    {
      "type": "header",
      "content": "Offer 1"
    },
    {
      "type": "checkbox",
      "id": "card_1_enabled",
      "label": "Enable offer 1",
      "default": true
    },
    {
      "type": "text",
      "id": "heading_1",
      "label": "Heading",
      "default": "Get Best Offer and Deals"
    },
    {
      "type": "textarea",
      "id": "subheading_1",
      "label": "Subheading (can include HTML links)",
      "default": "Download our app now to claim yours."
    },
    {
      "type": "text",
      "id": "code_1",
      "label": "Coupon code",
      "default": "APP2024"
    },
    {
      "type": "textarea",
      "id": "description_1",
      "label": "Description",
      "default": "Valid for new app users only"
    },
    {
      "type": "header",
      "content": "Offer 2"
    },
    {
      "type": "checkbox",
      "id": "card_2_enabled",
      "label": "Enable offer 2",
      "default": true
    },
    {
      "type": "text",
      "id": "heading_2",
      "label": "Heading",
      "default": "20% OFF Your First Order"
    },
    {
      "type": "textarea",
      "id": "subheading_2",
      "label": "Subheading",
      "default": "Sign up today and save big on your purchase."
    },
    {
      "type": "text",
      "id": "code_2",
      "label": "Coupon code",
      "default": "WELCOME20"
    },
    {
      "type": "textarea",
      "id": "description_2",
      "label": "Description",
      "default": "Minimum order ৳500 required"
    },
    {
      "type": "header",
      "content": "Offer 3"
    },
    {
      "type": "checkbox",
      "id": "card_3_enabled",
      "label": "Enable offer 3",
      "default": true
    },
    {
      "type": "text",
      "id": "heading_3",
      "label": "Heading",
      "default": "Free Shipping Available"
    },
    {
      "type": "textarea",
      "id": "subheading_3",
      "label": "Subheading",
      "default": "Shop now and get free delivery on all orders."
    },
    {
      "type": "text",
      "id": "code_3",
      "label": "Coupon code",
      "default": "FREESHIP"
    },
    {
      "type": "textarea",
      "id": "description_3",
      "label": "Description",
      "default": "On orders above ৳1000"
    },
    {
      "type": "header",
      "content": "Offer 4"
    },
    {
      "type": "checkbox",
      "id": "card_4_enabled",
      "label": "Enable offer 4",
      "default": false
    },
    {
      "type": "text",
      "id": "heading_4",
      "label": "Heading"
    },
    {
      "type": "textarea",
      "id": "subheading_4",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "code_4",
      "label": "Coupon code"
    },
    {
      "type": "textarea",
      "id": "description_4",
      "label": "Description"
    },
    {
      "type": "header",
      "content": "Offer 5"
    },
    {
      "type": "checkbox",
      "id": "card_5_enabled",
      "label": "Enable offer 5",
      "default": false
    },
    {
      "type": "text",
      "id": "heading_5",
      "label": "Heading"
    },
    {
      "type": "textarea",
      "id": "subheading_5",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "code_5",
      "label": "Coupon code"
    },
    {
      "type": "textarea",
      "id": "description_5",
      "label": "Description"
    }
  ],
  "presets": [
    {
      "name": "Ticket Offer Cards"
    }
  ]
}
{% endschema %}