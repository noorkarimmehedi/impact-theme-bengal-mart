{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
NOTE TO DEVELOPERS: welcome to Impact theme! We hope that you will enjoy editing this theme as much as we did for
  developing it. We have put a lot of work to make this theme as developer friendly as possible by offering you
  hooks to integrate into critical parts of the theme. You will find the complete technical documentation (including
  all events, dependencies...) in the "documentation.txt" file, located in the Assets folder.
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<!doctype html>

<html class="no-js" lang="{{ request.locale.iso_code }}" dir="{% render 'direction' %}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="theme-color" content="{{ settings.header_background }}">

    <title>{% if page_title == blank %}{{ shop.name }}{% else %}{{ page_title }}{% if current_page != 1 %} &ndash; {{ 'general.page' | t: page: current_page }}{% endif %}{% endif %}</title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 96 }}">
      <link rel="apple-touch-icon" href="{{ settings.favicon | image_url: width: 180 }}">
    {%- endif -%}

    {%- comment -%}Few prefetch to increase performance on commonly used third-parties{%- endcomment -%}
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com">

    {%- unless settings.heading_font.system? -%}
      <link rel="preload" href="{{ settings.heading_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- unless settings.text_font.system? -%}
      <link rel="preload" href="{{ settings.text_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- render 'social-meta-tags' -%}
    {%- render 'microdata-schema' -%}
    {%- render 'css-variables' -%}
    {%- render 'js-variables' -%}

    <script type="module" src="{{ 'vendor.min.js' | asset_url }}"></script>
    <script type="module" src="{{ 'theme.js' | asset_url }}"></script>
    <script type="module" src="{{ 'sections.js' | asset_url }}"></script>

    {{ content_for_header }}

    {{- 'theme.css' | asset_url | stylesheet_tag: preload: true -}}
  </head>

  <body class="{% if settings.show_page_transition %}page-transition{% endif %} {% if settings.zoom_image_on_hover %}zoom-image--enabled{% endif %}">
    {%- render 'shadow-dom-templates' -%}

    <a href="#main" class="skip-to-content sr-only">{{ 'general.accessibility.skip_to_content' | t }}</a>

    {%- if request.page_type != 'password' -%}
      {%- sections 'header-group' -%}
      {%- sections 'overlay-group' -%}

      {%- if settings.cart_type == 'popover' -%}
        <cart-notification-drawer open-from="bottom" class="quick-buy-drawer drawer"></cart-notification-drawer>
      {%- endif -%}
    {%- endif -%}

    {%- if request.page_type == 'customers/account' or request.page_type == 'customers/order' or request.page_type == 'customers/addresses' -%}
      {%- section 'account-banner' -%}
    {%- endif -%}

    <main role="main" id="main" class="anchor">
      {{ content_for_layout }}

      {%- comment -%}
      IMPLEMENTATION NOTE: due to the very complex logic of margin/padding collapsing in Impact, the footer group is
      added into the main element to ensure that dynamic sections added into the footer group are properly laid out.
      {%- endcomment -%}
      {%- if request.page_type != 'password' -%}
        {%- sections 'footer-group' -%}
      {%- endif -%}
    </main>
    {%- comment -%} WhatsApp Chat Widget {%- endcomment -%}
    {% render 'whatsapp-widget' %}
  </body>
</html>

<style>
  /* Change top area color to match announcement bar on mobile */
  @media screen and (max-width: 1000px) {
    body {
      background-color: #7900FD;
    }
    
    .shopify-section-group-header-group {
      background-color: #7900FD;
    }
    
    body, html {
      margin: 0;
      padding: 0;
    }
  }

  /* Modern Sticky Bottom Navigation - Mobile Only */
  @media screen and (max-width: 768px) {
    .mobile-bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      background: linear-gradient(to top, #ffffff 0%, #fafafa 100%);
      border-top: 1px solid rgba(0, 0, 0, 0.06);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 8px 12px 12px;
      z-index: 1000;
      box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.08), 0 -2px 8px rgba(0, 0, 0, 0.04);
      transform: translateZ(0);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      will-change: transform;
      touch-action: manipulation;
      /* Safe area for notched devices */
      padding-bottom: max(12px, env(safe-area-inset-bottom));
    }
    
    /* Add padding to body to prevent content overlap */
    body {
      padding-bottom: calc(72px + env(safe-area-inset-bottom));
    }
    
    .mobile-bottom-nav a {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      flex: 1;
      max-width: 84px;
      color: #666;
      text-decoration: none;
      font-size: 11px;
      font-weight: 500;
      position: relative;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      padding: 6px 4px;
      border-radius: 12px;
    }
    
    /* Active state background */
    .mobile-bottom-nav a::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(121, 0, 253, 0.08), rgba(121, 0, 253, 0.12));
      opacity: 0;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: -1;
    }
    
    /* Touch feedback */
    .mobile-bottom-nav a:active::before {
      opacity: 1;
      transform: scale(0.94);
    }
    
    .mobile-bottom-nav a:active {
      color: #7900FD;
      transform: translateY(-1px);
    }
    
    .mobile-bottom-nav a:active svg {
      transform: scale(0.92);
    }
    
    /* Icon container with gradient background on active */
    .nav-icon-wrapper {
      position: relative;
      width: 52px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 20px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .mobile-bottom-nav a:active .nav-icon-wrapper {
      background: linear-gradient(135deg, rgba(121, 0, 253, 0.12), rgba(121, 0, 253, 0.18));
    }
    
    .mobile-bottom-nav a svg {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      stroke-width: 1.8;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .mobile-bottom-nav a span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      letter-spacing: -0.01em;
    }
    
    /* Enhanced Cart Badge with gradient */
    .cart-badge {
      position: absolute;
      top: -4px;
      right: 6px;
      background: linear-gradient(135deg, #FF3B5C, #FF1744);
      color: white;
      border-radius: 12px;
      padding: 2px 6px;
      font-size: 10px;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
      box-shadow: 0 2px 8px rgba(255, 23, 68, 0.4), 0 0 0 2px rgba(255, 255, 255, 0.9);
      animation: badge-pulse 2s ease-in-out infinite;
      letter-spacing: -0.02em;
    }
    
    @keyframes badge-pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    
    .cart-badge.hidden {
      display: none;
    }
    
    /* Special styling for center action button (Shop Under ৳500) */
    .mobile-bottom-nav a.center-action {
      position: relative;
    }
    
    .mobile-bottom-nav a.center-action .nav-icon-wrapper {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #7900FD, #9D4EDD);
      box-shadow: 0 4px 16px rgba(121, 0, 253, 0.3), 0 2px 8px rgba(121, 0, 253, 0.2);
      border-radius: 50%;
      margin-bottom: 4px;
      border: 3px solid #ffffff;
      transform: translateY(-8px);
    }
    
    .mobile-bottom-nav a.center-action svg {
      color: white;
      width: 26px;
      height: 26px;
    }
    
    .mobile-bottom-nav a.center-action span {
      color: #7900FD;
      font-weight: 600;
      font-size: 10px;
    }
    
    .mobile-bottom-nav a.center-action:active .nav-icon-wrapper {
      background: linear-gradient(135deg, #6600D9, #8A3FBF);
      transform: translateY(-6px) scale(0.96);
    }
    
    /* Ripple effect on tap */
    .nav-ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(121, 0, 253, 0.3);
      transform: scale(0);
      animation: ripple-animation 0.6s ease-out;
      pointer-events: none;
    }
    
    @keyframes ripple-animation {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
  }

  /* Ensure hidden on larger screens */
  @media screen and (min-width: 769px) {
    .mobile-bottom-nav {
      display: none;
    }
    
    body {
      padding-bottom: 0;
    }
  }
</style>

{% unless template == 'checkout' %}
  <div class="mobile-bottom-nav">
    <a href="/" title="Home">
      <div class="nav-icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
      </div>
      <span>Home</span>
    </a>
    
    <a href="https://bengal-mart.shop/pages/all-categories" title="Categories">
      <div class="nav-icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="3" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="14" width="7" height="7" rx="1"/>
          <rect x="3" y="14" width="7" height="7" rx="1"/>
        </svg>
      </div>
      <span>Categories</span>
    </a>

    <a href="/collections" title="Shop Under ৳500" class="center-action">
      <div class="nav-icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          <path d="M12 2L9 9l7 1"/>
        </svg>
      </div>
      <span>Under ৳500</span>
    </a>
    
    <a href="/search" title="Search">
      <div class="nav-icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </div>
      <span>Search</span>
    </a>
    
    <a href="/cart" title="Cart">
      <div class="nav-icon-wrapper">
        <span class="cart-badge {% if cart.item_count == 0 %}hidden{% endif %}" id="mobile-cart-badge">
          {{ cart.item_count }}
        </span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <path d="M16 10a4 4 0 0 1-8 0"/>
        </svg>
      </div>
      <span>Cart</span>
    </a>
  </div>
{% endunless %}

<script>
  (function() {
    'use strict';
    
    // Ripple effect on tap
    function createRipple(event) {
      const button = event.currentTarget;
      const ripple = document.createElement('span');
      const rect = button.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = event.clientX - rect.left - size / 2;
      const y = event.clientY - rect.top - size / 2;
      
      ripple.className = 'nav-ripple';
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';
      
      button.appendChild(ripple);
      
      setTimeout(() => ripple.remove(), 600);
    }
    
    // Add ripple to all nav links
    document.querySelectorAll('.mobile-bottom-nav a').forEach(link => {
      link.addEventListener('click', createRipple);
    });
    
    // Prevent navbar from shifting on mobile browsers
    let ticking = false;
    
    function fixNavbarPosition() {
      const navbar = document.querySelector('.mobile-bottom-nav');
      if (!navbar) return;
      
      navbar.style.bottom = '0';
      
      if (!ticking) {
        window.requestAnimationFrame(() => {
          navbar.style.bottom = '0';
          ticking = false;
        });
        ticking = true;
      }
    }
    
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(fixNavbarPosition, 50);
    }, { passive: true });
    
    window.addEventListener('resize', fixNavbarPosition, { passive: true });
    window.addEventListener('orientationchange', () => {
      setTimeout(fixNavbarPosition, 100);
    });
    
    // Update mobile cart badge
    function updateMobileCartBadge() {
      fetch('/cart.js')
        .then(response => response.json())
        .then(cart => {
          const badge = document.getElementById('mobile-cart-badge');
          if (badge) {
            badge.textContent = cart.item_count;
            if (cart.item_count > 0) {
              badge.classList.remove('hidden');
            } else {
              badge.classList.add('hidden');
            }
          }
        })
        .catch(error => console.error('Error updating cart badge:', error));
    }

    // Intercept fetch for cart changes
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      const url = args[0];
      
      return originalFetch.apply(this, args).then(response => {
        if (typeof url === 'string' && 
            (url.includes('/cart/add') || 
             url.includes('/cart/change') || 
             url.includes('/cart/update') ||
             url.includes('/cart/clear'))) {
          setTimeout(updateMobileCartBadge, 300);
        }
        return response;
      });
    };

    // Initialize on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        updateMobileCartBadge();
        fixNavbarPosition();
      });
    } else {
      updateMobileCartBadge();
      fixNavbarPosition();
    }
    
    // Listen for cart events
    const cartEvents = [
      'cart:updated',
      'cart:refresh',
      'cart.requestComplete',
      'ajaxCart:added',
      'ajaxCart:updated',
      'product:added',
      'variant:add'
    ];
    
    cartEvents.forEach(event => {
      document.addEventListener(event, updateMobileCartBadge);
    });
    
    // Form submission listener
    document.addEventListener('submit', function(e) {
      if (e.target.matches('form[action*="/cart/add"]')) {
        setTimeout(updateMobileCartBadge, 500);
      }
    });
    
    // Click listener for add to cart
    document.addEventListener('click', function(e) {
      const target = e.target.closest('[name="add"], .add-to-cart, .product-form__submit');
      if (target) {
        setTimeout(updateMobileCartBadge, 500);
      }
    });
    
    // Haptic feedback
    document.querySelectorAll('.mobile-bottom-nav a').forEach(link => {
      link.addEventListener('touchstart', function(e) {
        try {
          if ('vibrate' in navigator) {
            navigator.vibrate(10);
          }
        } catch (error) {
          // Silently fail
        }
      }, { passive: true });
    });

    // Periodic cart check (every 2 seconds)
    let lastKnownCount = {{ cart.item_count }};
    setInterval(function() {
      if (!document.hidden) {
        fetch('/cart.js')
          .then(response => response.json())
          .then(cart => {
            if (cart.item_count !== lastKnownCount) {
              lastKnownCount = cart.item_count;
              updateMobileCartBadge();
            }
          })
          .catch(() => {});
      }
    }, 2000);
  })();
</script>

</body>
</html>