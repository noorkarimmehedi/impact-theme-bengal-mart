{% doc %}
  @prompt
    generate me a section where my customer put their city name and they will get a real time date when their good will be delivery if they order today . my business based in bangladesh 
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-delivery-calculator-{{ ai_gen_id }} {
    padding: 30px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    max-width: 600px;
    margin: 0 auto;
  }

  .ai-delivery-calculator__heading-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.heading_size }}px;
    margin: 0 0 10px;
    text-align: center;
  }

  .ai-delivery-calculator__subtext-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    opacity: 0.8;
    font-size: 14px;
    text-align: center;
    margin: 0 0 24px;
  }

  .ai-delivery-calculator__form-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .ai-delivery-calculator__input-wrapper-{{ ai_gen_id }} {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .ai-delivery-calculator__input-{{ ai_gen_id }} {
    flex: 1;
    min-width: 200px;
    padding: 14px 16px;
    border: 2px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 15px;
    transition: border-color 0.3s ease;
  }

  .ai-delivery-calculator__input-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.primary_color }};
  }

  .ai-delivery-calculator__button-{{ ai_gen_id }} {
    padding: 14px 28px;
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
    white-space: nowrap;
  }

  .ai-delivery-calculator__button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
  }

  .ai-delivery-calculator__result-{{ ai_gen_id }} {
    margin-top: 20px;
    padding: 20px;
    background-color: {{ block.settings.result_bg_color }};
    border-radius: {{ block.settings.border_radius }}px;
    border-left: 4px solid {{ block.settings.primary_color }};
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .ai-delivery-calculator__result-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
  }

  .ai-delivery-calculator__result-title-{{ ai_gen_id }} {
    color: {{ block.settings.primary_color }};
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 8px;
  }

  .ai-delivery-calculator__result-date-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: 20px;
    font-weight: 700;
    margin: 0 0 8px;
  }

  .ai-delivery-calculator__result-info-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    opacity: 0.7;
    font-size: 14px;
    margin: 0;
  }

  .ai-delivery-calculator__error-{{ ai_gen_id }} {
    margin-top: 12px;
    padding: 12px;
    background-color: {{ block.settings.error_bg_color }};
    color: {{ block.settings.error_text_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 14px;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .ai-delivery-calculator__error-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
  }

  @media screen and (max-width: 749px) {
    .ai-delivery-calculator-{{ ai_gen_id }} {
      padding: 20px;
    }

    .ai-delivery-calculator__input-wrapper-{{ ai_gen_id }} {
      flex-direction: column;
    }

    .ai-delivery-calculator__input-{{ ai_gen_id }} {
      min-width: 100%;
    }

    .ai-delivery-calculator__button-{{ ai_gen_id }} {
      width: 100%;
    }
  }
{% endstyle %}

<delivery-calculator-{{ ai_gen_id }}
  class="ai-delivery-calculator-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <h2 class="ai-delivery-calculator__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
  {% if block.settings.subtext != blank %}
    <p class="ai-delivery-calculator__subtext-{{ ai_gen_id }}">{{ block.settings.subtext }}</p>
  {% endif %}

  <div class="ai-delivery-calculator__form-{{ ai_gen_id }}">
    <div class="ai-delivery-calculator__input-wrapper-{{ ai_gen_id }}">
      <input
        type="text"
        class="ai-delivery-calculator__input-{{ ai_gen_id }}"
        placeholder="{{ block.settings.input_placeholder }}"
        aria-label="Enter your city name"
        data-city-input
      >
      <button
        type="button"
        class="ai-delivery-calculator__button-{{ ai_gen_id }}"
        data-calculate-btn
      >
        {{ block.settings.button_text }}
      </button>
    </div>

    <div class="ai-delivery-calculator__error-{{ ai_gen_id }}" data-error-message></div>

    <div class="ai-delivery-calculator__result-{{ ai_gen_id }}" data-result>
      <p class="ai-delivery-calculator__result-title-{{ ai_gen_id }}">{{ block.settings.result_title }}</p>
      <p class="ai-delivery-calculator__result-date-{{ ai_gen_id }}" data-delivery-date></p>
      <p class="ai-delivery-calculator__result-info-{{ ai_gen_id }}" data-delivery-info></p>
    </div>
  </div>
</delivery-calculator-{{ ai_gen_id }}>

<script>
  (function() {
    class DeliveryCalculator{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.cityInput = this.querySelector('[data-city-input]');
        this.calculateBtn = this.querySelector('[data-calculate-btn]');
        this.resultContainer = this.querySelector('[data-result]');
        this.deliveryDateEl = this.querySelector('[data-delivery-date]');
        this.deliveryInfoEl = this.querySelector('[data-delivery-info]');
        this.errorMessage = this.querySelector('[data-error-message]');

        this.deliveryDays = {
          'dhaka': {{ block.settings.dhaka_days }},
          'chattogram': {{ block.settings.chattogram_days }},
          'chittagong': {{ block.settings.chattogram_days }},
          'sylhet': {{ block.settings.sylhet_days }},
          'rajshahi': {{ block.settings.rajshahi_days }},
          'khulna': {{ block.settings.khulna_days }},
          'barishal': {{ block.settings.barishal_days }},
          'barisal': {{ block.settings.barishal_days }},
          'rangpur': {{ block.settings.rangpur_days }},
          'mymensingh': {{ block.settings.mymensingh_days }},
          'comilla': {{ block.settings.other_cities_days }},
          'gazipur': {{ block.settings.other_cities_days }},
          'narayanganj': {{ block.settings.other_cities_days }},
          'cox\'s bazar': {{ block.settings.other_cities_days }},
          'coxs bazar': {{ block.settings.other_cities_days }},
          'jessore': {{ block.settings.other_cities_days }},
          'bogra': {{ block.settings.other_cities_days }},
          'dinajpur': {{ block.settings.other_cities_days }},
          'pabna': {{ block.settings.other_cities_days }},
          'tangail': {{ block.settings.other_cities_days }},
          'jamalpur': {{ block.settings.other_cities_days }},
          'default': {{ block.settings.default_days }}
        };

        this.monthNames = ['জানুয়ারি', 'ফেব্রুয়ারি', 'মার্চ', 'এপ্রিল', 'মে', 'জুন', 'জুলাই', 'আগস্ট', 'সেপ্টেম্বর', 'অক্টোবর', 'নভেম্বর', 'ডিসেম্বর'];
        this.monthNamesEn = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      }

      connectedCallback() {
        this.calculateBtn.addEventListener('click', () => this.calculateDelivery());
        this.cityInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            this.calculateDelivery();
          }
        });
      }

      calculateDelivery() {
        const city = this.cityInput.value.trim().toLowerCase();

        if (!city) {
          this.showError('{{ block.settings.error_empty }}');
          return;
        }

        this.hideError();

        const days = this.deliveryDays[city] || this.deliveryDays['default'];
        const deliveryDate = this.getDeliveryDate(days);
        const formattedDate = this.formatDate(deliveryDate);

        this.deliveryDateEl.textContent = formattedDate;
        this.deliveryInfoEl.textContent = '{{ block.settings.result_info }}'.replace('[DAYS]', days).replace('[CITY]', this.capitalizeCity(this.cityInput.value.trim()));

        this.resultContainer.classList.add('active');
      }

      getDeliveryDate(days) {
        const today = new Date();
        const deliveryDate = new Date(today);
        deliveryDate.setDate(today.getDate() + days);
        return deliveryDate;
      }

      formatDate(date) {
        const day = date.getDate();
        const month = date.getMonth();
        const year = date.getFullYear();

        {% if block.settings.date_format == 'bengali' %}
          return day + ' ' + this.monthNames[month] + ', ' + year;
        {% else %}
          return day + ' ' + this.monthNamesEn[month] + ', ' + year;
        {% endif %}
      }

      capitalizeCity(city) {
        return city.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
      }

      showError(message) {
        this.errorMessage.textContent = message;
        this.errorMessage.classList.add('active');
        this.resultContainer.classList.remove('active');
      }

      hideError() {
        this.errorMessage.classList.remove('active');
      }
    }

    customElements.define('delivery-calculator-{{ ai_gen_id }}', DeliveryCalculator{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Delivery date calculator",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Check Delivery Date"
    },
    {
      "type": "text",
      "id": "subtext",
      "label": "Subtext",
      "default": "Enter your city to see when you'll receive your order"
    },
    {
      "type": "text",
      "id": "input_placeholder",
      "label": "Input placeholder",
      "default": "Enter your city name"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Calculate"
    },
    {
      "type": "text",
      "id": "result_title",
      "label": "Result title",
      "default": "Estimated Delivery Date:"
    },
    {
      "type": "text",
      "id": "result_info",
      "label": "Result info text",
      "default": "Your order will arrive in [DAYS] days to [CITY]"
    },
    {
      "type": "text",
      "id": "error_empty",
      "label": "Empty field error",
      "default": "Please enter your city name"
    },
    {
      "type": "header",
      "content": "Delivery days by city"
    },
    {
      "type": "range",
      "id": "dhaka_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Dhaka",
      "default": 2
    },
    {
      "type": "range",
      "id": "chattogram_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Chattogram",
      "default": 3
    },
    {
      "type": "range",
      "id": "sylhet_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Sylhet",
      "default": 4
    },
    {
      "type": "range",
      "id": "rajshahi_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Rajshahi",
      "default": 4
    },
    {
      "type": "range",
      "id": "khulna_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Khulna",
      "default": 4
    },
    {
      "type": "range",
      "id": "barishal_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Barishal",
      "default": 4
    },
    {
      "type": "range",
      "id": "rangpur_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Rangpur",
      "default": 5
    },
    {
      "type": "range",
      "id": "mymensingh_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Mymensingh",
      "default": 4
    },
    {
      "type": "range",
      "id": "other_cities_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Other major cities",
      "default": 5
    },
    {
      "type": "range",
      "id": "default_days",
      "min": 1,
      "max": 15,
      "step": 1,
      "unit": "d",
      "label": "Default (unknown cities)",
      "default": 7
    },
    {
      "type": "header",
      "content": "Date format"
    },
    {
      "type": "select",
      "id": "date_format",
      "label": "Date language",
      "options": [
        {
          "value": "english",
          "label": "English"
        },
        {
          "value": "bengali",
          "label": "Bengali (বাংলা)"
        }
      ],
      "default": "english"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 24
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Input border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary accent",
      "default": "#00badb"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Input border",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button background",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Button hover",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "result_bg_color",
      "label": "Result background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "error_bg_color",
      "label": "Error background",
      "default": "#fee"
    },
    {
      "type": "color",
      "id": "error_text_color",
      "label": "Error text",
      "default": "#c00"
    }
  ],
  "presets": [
    {
      "name": "Delivery date calculator"
    }
  ]
}
{% endschema %}