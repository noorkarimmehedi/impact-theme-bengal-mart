{% doc %}
  @prompt
    1. Header Text and Countdown Timer
    
    A small clock icon at the beginning.
    
    Text:
    ‚ÄúOrder today within [countdown timer] for dispatch today. You‚Äôll receive your package between [Start Date] to [End Date].‚Äù
    
    Countdown timer dynamically shows the remaining time before the same-day dispatch cut-off.
    
    The delivery date range (e.g., Dec 21 to Dec 28) should be dynamic based on current date + shipping rules.
    
    2. Timeline Box Design
    
    A rectangular box with light grey background and rounded corners.
    
    Inside the box, display a 3-step progress timeline horizontally:
    
    Icon	Title	Date
    üõçÔ∏è (shopping bag icon)	Order purchased	Example: Dec 11
    üöö (delivery truck icon)	Order processing	Example: Dec 12 ‚Äì 14
    üìç (location pin icon)	Order delivered	Example: Dec 21 ‚Äì 28
    
    Dots and connecting lines between each stage, like a progress tracker.
    
    Dates should be editable from the theme editor.
    
    3. Functionality Requirements
    
    All text and date fields must be customizable in Shopify theme editor.
    
    Countdown timer should automatically reset every day at the dispatch cut-off time.
    
    Fully responsive on desktop and mobile.
    
    Icons should be lightweight SVGs or Shopify icons.
    
    4. Style Notes
    
    Font similar to Shopify default (clean, modern, minimal).
    
    Text color: dark grey or black.
    
    Background of timeline box: light grey (#f5f5f5 or similar).
    
    Rounded corners and subtle shadow like the example.
    
    Spacing and alignment must match the attached design., Text before countdown and 
    Text after countdown. should be in same line with bold timer. also Order dates should be adjustable like 2 days not i need to put dates , Text before countdown and 
    Text after countdown. should be in same line with bold timer. in mobile version, Text before countdown and 
    Text after countdown. should be in same line with bold timer. should be option for alligment , timer clock icon also should be also allinged with text alligment  in both mobile and desktop, Text before countdown
    
    Text after countdown. should be same line in mobile version.also remove the small clock icon 
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-delivery-timeline-{{ ai_gen_id }} {
    width: 100%;
    max-width: 100%;
  }

  .ai-delivery-header-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
    text-align: {{ block.settings.text_alignment }};
    justify-content: {{ block.settings.text_alignment }};
    flex-wrap: wrap;
  }

  .ai-delivery-header-{{ ai_gen_id }} svg {
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    flex-shrink: 0;
    color: {{ block.settings.text_color }};
  }

  .ai-delivery-header-text-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.4;
  }

  .ai-delivery-countdown-{{ ai_gen_id }} {
    font-weight: 700;
    color: {{ block.settings.countdown_color }};
    white-space: nowrap;
  }

  .ai-delivery-timeline-box-{{ ai_gen_id }} {
    background-color: {{ block.settings.box_background }};
    border-radius: {{ block.settings.box_border_radius }}px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .ai-delivery-steps-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 16px;
    position: relative;
  }

  .ai-delivery-step-{{ ai_gen_id }} {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
    z-index: 2;
  }

  .ai-delivery-step-icon-{{ ai_gen_id }} {
    width: {{ block.settings.step_icon_size }}px;
    height: {{ block.settings.step_icon_size }}px;
    background-color: {{ block.settings.step_icon_background }};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 12px;
    position: relative;
    z-index: 3;
  }

  .ai-delivery-step-icon-{{ ai_gen_id }} svg {
    width: calc({{ block.settings.step_icon_size }}px * 0.5);
    height: calc({{ block.settings.step_icon_size }}px * 0.5);
    color: {{ block.settings.step_icon_color }};
  }

  .ai-delivery-step-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.step_title_size }}px;
    font-weight: 600;
    color: {{ block.settings.step_text_color }};
    margin-bottom: 6px;
  }

  .ai-delivery-step-date-{{ ai_gen_id }} {
    font-size: {{ block.settings.step_date_size }}px;
    color: {{ block.settings.step_date_color }};
  }

  .ai-delivery-connector-{{ ai_gen_id }} {
    position: absolute;
    top: calc({{ block.settings.step_icon_size }}px / 2);
    left: 0;
    right: 0;
    height: 2px;
    background-color: {{ block.settings.connector_color }};
    z-index: 1;
  }

  .ai-delivery-dots-{{ ai_gen_id }} {
    position: absolute;
    top: calc({{ block.settings.step_icon_size }}px / 2 - 4px);
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    padding: 0 calc(50% / 3);
    z-index: 2;
  }

  .ai-delivery-dot-{{ ai_gen_id }} {
    width: 8px;
    height: 8px;
    background-color: {{ block.settings.connector_color }};
    border-radius: 50%;
  }

  @media screen and (max-width: 749px) {
    .ai-delivery-header-{{ ai_gen_id }} {
      text-align: {{ block.settings.text_alignment_mobile }};
      justify-content: {{ block.settings.text_alignment_mobile }};
    }

    .ai-delivery-header-{{ ai_gen_id }} svg {
      display: none;
    }

    .ai-delivery-header-text-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.text_size }}px * 0.9);
      flex-wrap: nowrap;
    }

    .ai-delivery-timeline-box-{{ ai_gen_id }} {
      padding: 16px;
    }

    .ai-delivery-steps-{{ ai_gen_id }} {
      gap: 8px;
    }

    .ai-delivery-step-icon-{{ ai_gen_id }} {
      width: calc({{ block.settings.step_icon_size }}px * 0.8);
      height: calc({{ block.settings.step_icon_size }}px * 0.8);
    }

    .ai-delivery-step-icon-{{ ai_gen_id }} svg {
      width: calc({{ block.settings.step_icon_size }}px * 0.4);
      height: calc({{ block.settings.step_icon_size }}px * 0.4);
    }

    .ai-delivery-step-title-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.step_title_size }}px * 0.85);
    }

    .ai-delivery-step-date-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.step_date_size }}px * 0.85);
    }

    .ai-delivery-connector-{{ ai_gen_id }} {
      top: calc(({{ block.settings.step_icon_size }}px * 0.8) / 2);
    }

    .ai-delivery-dots-{{ ai_gen_id }} {
      top: calc(({{ block.settings.step_icon_size }}px * 0.8) / 2 - 4px);
    }
  }
{% endstyle %}

<delivery-timeline-{{ ai_gen_id }} class="ai-delivery-timeline-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-delivery-header-{{ ai_gen_id }}">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"></circle>
      <polyline points="12 6 12 12 16 14"></polyline>
    </svg>
    <div class="ai-delivery-header-text-{{ ai_gen_id }}">
      <span>{{ block.settings.text_before_countdown }}</span>
      <span class="ai-delivery-countdown-{{ ai_gen_id }}" data-cutoff-hour="{{ block.settings.cutoff_hour }}">00:00:00</span>
      <span>{{ block.settings.text_after_countdown }}</span>
    </div>
  </div>

  <div class="ai-delivery-timeline-box-{{ ai_gen_id }}">
    <div class="ai-delivery-steps-{{ ai_gen_id }}">
      <div class="ai-delivery-connector-{{ ai_gen_id }}"></div>
      <div class="ai-delivery-dots-{{ ai_gen_id }}">
        <div class="ai-delivery-dot-{{ ai_gen_id }}"></div>
        <div class="ai-delivery-dot-{{ ai_gen_id }}"></div>
      </div>

      <div class="ai-delivery-step-{{ ai_gen_id }}">
        <div class="ai-delivery-step-icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
        </div>
        <div class="ai-delivery-step-title-{{ ai_gen_id }}">{{ block.settings.step1_title }}</div>
        <div class="ai-delivery-step-date-{{ ai_gen_id }}" data-days-offset="0">{{ block.settings.step1_date }}</div>
      </div>

      <div class="ai-delivery-step-{{ ai_gen_id }}">
        <div class="ai-delivery-step-icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="1" y="3" width="15" height="13"></rect>
            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
            <circle cx="5.5" cy="18.5" r="2.5"></circle>
            <circle cx="18.5" cy="18.5" r="2.5"></circle>
          </svg>
        </div>
        <div class="ai-delivery-step-title-{{ ai_gen_id }}">{{ block.settings.step2_title }}</div>
        <div class="ai-delivery-step-date-{{ ai_gen_id }}" data-days-offset="{{ block.settings.processing_days }}">{{ block.settings.step2_date }}</div>
      </div>

      <div class="ai-delivery-step-{{ ai_gen_id }}">
        <div class="ai-delivery-step-icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
        </div>
        <div class="ai-delivery-step-title-{{ ai_gen_id }}">{{ block.settings.step3_title }}</div>
        <div class="ai-delivery-step-date-{{ ai_gen_id }}" data-days-offset="{{ block.settings.delivery_days }}">{{ block.settings.step3_date }}</div>
      </div>
    </div>
  </div>
</delivery-timeline-{{ ai_gen_id }}>

<script>
  (function() {
    class DeliveryTimeline{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.countdownElement = this.querySelector('.ai-delivery-countdown-{{ ai_gen_id }}');
        this.dateElements = this.querySelectorAll('.ai-delivery-step-date-{{ ai_gen_id }}');
        this.cutoffHour = parseInt(this.countdownElement.dataset.cutoffHour) || 14;
      }

      connectedCallback() {
        this.updateCountdown();
        this.updateDates();
        this.interval = setInterval(() => this.updateCountdown(), 1000);
      }

      disconnectedCallback() {
        if (this.interval) {
          clearInterval(this.interval);
        }
      }

      updateCountdown() {
        const now = new Date();
        const cutoffTime = new Date();
        cutoffTime.setHours(this.cutoffHour, 0, 0, 0);

        if (now >= cutoffTime) {
          cutoffTime.setDate(cutoffTime.getDate() + 1);
        }

        const diff = cutoffTime - now;
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        this.countdownElement.textContent = 
          String(hours).padStart(2, '0') + ':' +
          String(minutes).padStart(2, '0') + ':' +
          String(seconds).padStart(2, '0');
      }

      updateDates() {
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        this.dateElements.forEach((element) => {
          const daysOffset = parseInt(element.dataset.daysOffset) || 0;
          
          if (daysOffset === 0) {
            const today = new Date();
            element.textContent = monthNames[today.getMonth()] + ' ' + today.getDate();
          } else if (element.dataset.daysOffset.includes('-')) {
            const [startDays, endDays] = element.dataset.daysOffset.split('-').map(Number);
            const startDate = new Date();
            startDate.setDate(startDate.getDate() + startDays);
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + endDays);
            
            element.textContent = 
              monthNames[startDate.getMonth()] + ' ' + startDate.getDate() + ' ‚Äì ' +
              monthNames[endDate.getMonth()] + ' ' + endDate.getDate();
          } else {
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + daysOffset);
            element.textContent = monthNames[futureDate.getMonth()] + ' ' + futureDate.getDate();
          }
        });
      }
    }

    customElements.define('delivery-timeline-{{ ai_gen_id }}', DeliveryTimeline{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Delivery timeline",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Countdown header"
    },
    {
      "type": "text",
      "id": "text_before_countdown",
      "label": "Text before countdown",
      "default": "Order today within"
    },
    {
      "type": "text",
      "id": "text_after_countdown",
      "label": "Text after countdown",
      "default": "for dispatch today. You'll receive your package between the dates shown below."
    },
    {
      "type": "range",
      "id": "cutoff_hour",
      "min": 0,
      "max": 23,
      "step": 1,
      "label": "Daily cutoff hour (24h format)",
      "default": 14
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment (desktop)",
      "options": [
        {
          "value": "flex-start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "flex-end",
          "label": "Right"
        }
      ],
      "default": "flex-start"
    },
    {
      "type": "select",
      "id": "text_alignment_mobile",
      "label": "Text alignment (mobile)",
      "options": [
        {
          "value": "flex-start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "flex-end",
          "label": "Right"
        }
      ],
      "default": "flex-start"
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 16,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Clock icon size",
      "default": 20
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 14
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "countdown_color",
      "label": "Countdown color",
      "default": "#d82c0d"
    },
    {
      "type": "header",
      "content": "Timeline box"
    },
    {
      "type": "color",
      "id": "box_background",
      "label": "Background",
      "default": "#f5f5f5"
    },
    {
      "type": "range",
      "id": "box_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Step 1 - Order purchased"
    },
    {
      "type": "text",
      "id": "step1_title",
      "label": "Title",
      "default": "Order purchased"
    },
    {
      "type": "text",
      "id": "step1_date",
      "label": "Date (auto-calculated as today)"
    },
    {
      "type": "header",
      "content": "Step 2 - Order processing"
    },
    {
      "type": "text",
      "id": "step2_title",
      "label": "Title",
      "default": "Order processing"
    },
    {
      "type": "text",
      "id": "step2_date",
      "label": "Date (auto-calculated)"
    },
    {
      "type": "text",
      "id": "processing_days",
      "label": "Processing days range",
      "default": "1-3",
      "info": "Enter as single number (e.g., 2) or range (e.g., 1-3)"
    },
    {
      "type": "header",
      "content": "Step 3 - Order delivered"
    },
    {
      "type": "text",
      "id": "step3_title",
      "label": "Title",
      "default": "Order delivered"
    },
    {
      "type": "text",
      "id": "step3_date",
      "label": "Date (auto-calculated)"
    },
    {
      "type": "text",
      "id": "delivery_days",
      "label": "Delivery days range",
      "default": "10-17",
      "info": "Enter as single number (e.g., 7) or range (e.g., 10-17)"
    },
    {
      "type": "header",
      "content": "Step style"
    },
    {
      "type": "range",
      "id": "step_icon_size",
      "min": 40,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Icon circle size",
      "default": 56
    },
    {
      "type": "color",
      "id": "step_icon_background",
      "label": "Icon background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "step_icon_color",
      "label": "Icon color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "step_title_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Title size",
      "default": 14
    },
    {
      "type": "color",
      "id": "step_text_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "step_date_size",
      "min": 11,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Date size",
      "default": 13
    },
    {
      "type": "color",
      "id": "step_date_color",
      "label": "Date color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "connector_color",
      "label": "Connector line color",
      "default": "#cccccc"
    }
  ],
  "presets": [
    {
      "name": "Delivery timeline"
    }
  ]
}
{% endschema %}
