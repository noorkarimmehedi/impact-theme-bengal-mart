{% doc %}
  @prompt
    want a section like this: Delivery
    Enter Delivery Pincode
    Check Enter pincode
    Delivery by13 Nov, Thursday?
    if ordered before 4:33 PM
    instead of Enter pincode. I want Enter your city. and it should be for just Bangladesh. the UI should be like this : Border
    Border width
    
    1
    Border color
    
    #E0E0E0
    Hover border color
    
    #CCCCCC
    Border radius
    
    8
    Shadow
    Horizontal offset
    
    -7
    Vertical offset
    
    1
    Blur radius
    
    4
    Shadow opacity
    
    0
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-delivery-checker-{{ ai_gen_id }} {
    padding: {{ block.settings.padding }}px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    box-shadow: {{ block.settings.shadow_horizontal }}px {{ block.settings.shadow_vertical }}px {{ block.settings.shadow_blur }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity }});
    transition: border-color 0.3s ease;
  }

  .ai-delivery-checker-{{ ai_gen_id }}:hover {
    border-color: {{ block.settings.hover_border_color }};
  }

  .ai-delivery-checker__heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 16px 0;
  }

  .ai-delivery-checker__input-wrapper-{{ ai_gen_id }} {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }

  .ai-delivery-checker__input-{{ ai_gen_id }} {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 14px;
    color: {{ block.settings.text_color }};
  }

  .ai-delivery-checker__input-{{ ai_gen_id }}::placeholder {
    color: {{ block.settings.placeholder_color }};
  }

  .ai-delivery-checker__button-{{ ai_gen_id }} {
    padding: 12px 24px;
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s ease;
    white-space: nowrap;
  }

  .ai-delivery-checker__button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
  }

  .ai-delivery-checker__result-{{ ai_gen_id }} {
    display: none;
    padding: 16px;
    background-color: {{ block.settings.result_bg_color }};
    border-radius: {{ block.settings.result_border_radius }}px;
    border-left: 4px solid {{ block.settings.success_color }};
  }

  .ai-delivery-checker__result-{{ ai_gen_id }}.active {
    display: block;
  }

  .ai-delivery-checker__delivery-date-{{ ai_gen_id }} {
    font-size: 16px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0 0 8px 0;
  }

  .ai-delivery-checker__delivery-date-{{ ai_gen_id }} span {
    color: {{ block.settings.success_color }};
  }

  .ai-delivery-checker__delivery-condition-{{ ai_gen_id }} {
    font-size: 13px;
    color: {{ block.settings.secondary_text_color }};
    margin: 0;
  }

  .ai-delivery-checker__error-{{ ai_gen_id }} {
    display: none;
    padding: 12px 16px;
    background-color: {{ block.settings.error_bg_color }};
    color: {{ block.settings.error_color }};
    border-radius: {{ block.settings.result_border_radius }}px;
    font-size: 14px;
    margin-top: 12px;
  }

  .ai-delivery-checker__error-{{ ai_gen_id }}.active {
    display: block;
  }

  @media screen and (max-width: 749px) {
    .ai-delivery-checker__input-wrapper-{{ ai_gen_id }} {
      flex-direction: column;
    }

    .ai-delivery-checker__button-{{ ai_gen_id }} {
      width: 100%;
    }
  }
{% endstyle %}

<delivery-checker-{{ ai_gen_id }}
  class="ai-delivery-checker-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <h3 class="ai-delivery-checker__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h3>

  <div class="ai-delivery-checker__input-wrapper-{{ ai_gen_id }}">
    <input
      type="text"
      class="ai-delivery-checker__input-{{ ai_gen_id }}"
      placeholder="{{ block.settings.placeholder }}"
      aria-label="Enter your city"
    >
    <button
      type="button"
      class="ai-delivery-checker__button-{{ ai_gen_id }}"
      aria-label="Check delivery"
    >
      {{ block.settings.button_text }}
    </button>
  </div>

  <div class="ai-delivery-checker__result-{{ ai_gen_id }}">
    <p class="ai-delivery-checker__delivery-date-{{ ai_gen_id }}">
      Delivery by <span class="ai-delivery-date-value-{{ ai_gen_id }}"></span>
    </p>
    <p class="ai-delivery-checker__delivery-condition-{{ ai_gen_id }}">
      {{ block.settings.condition_text }}
    </p>
  </div>

  <div class="ai-delivery-checker__error-{{ ai_gen_id }}">
    {{ block.settings.error_message }}
  </div>
</delivery-checker-{{ ai_gen_id }}>

<script>
  (function() {
    class DeliveryChecker{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.bangladeshCities = [
          'dhaka', 'chittagong', 'chattogram', 'khulna', 'rajshahi', 'sylhet', 
          'barisal', 'rangpur', 'mymensingh', 'comilla', 'narayanganj', 
          'gazipur', 'tongi', 'narsingdi', 'jessore', 'bogra', 'dinajpur',
          'cox\'s bazar', 'coxs bazar', 'pabna', 'kushtia', 'tangail',
          'jamalpur', 'netrokona', 'sherpur', 'kishoreganj', 'brahmanbaria',
          'habiganj', 'moulvibazar', 'sunamganj', 'feni', 'lakshmipur',
          'noakhali', 'chandpur', 'munshiganj', 'madaripur', 'shariatpur',
          'gopalganj', 'faridpur', 'rajbari', 'manikganj', 'sirajganj',
          'natore', 'naogaon', 'chapainawabganj', 'joypurhat', 'thakurgaon',
          'panchagarh', 'nilphamari', 'lalmonirhat', 'kurigram', 'gaibandha',
          'jashore', 'satkhira', 'meherpur', 'narail', 'chuadanga', 'jhenaidah',
          'magura', 'bagerhat', 'pirojpur', 'jhalokati', 'patuakhali', 'barguna',
          'bhola', 'bandarban', 'khagrachari', 'rangamati'
        ];
      }

      connectedCallback() {
        this.input = this.querySelector('.ai-delivery-checker__input-{{ ai_gen_id }}');
        this.button = this.querySelector('.ai-delivery-checker__button-{{ ai_gen_id }}');
        this.result = this.querySelector('.ai-delivery-checker__result-{{ ai_gen_id }}');
        this.error = this.querySelector('.ai-delivery-checker__error-{{ ai_gen_id }}');
        this.dateValue = this.querySelector('.ai-delivery-date-value-{{ ai_gen_id }}');

        this.button.addEventListener('click', () => this.checkDelivery());
        this.input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            this.checkDelivery();
          }
        });
      }

      checkDelivery() {
        const city = this.input.value.trim().toLowerCase();

        this.result.classList.remove('active');
        this.error.classList.remove('active');

        if (!city) {
          this.error.classList.add('active');
          return;
        }

        const isBangladeshCity = this.bangladeshCities.some(bdCity => 
          city.includes(bdCity) || bdCity.includes(city)
        );

        if (!isBangladeshCity) {
          this.error.classList.add('active');
          return;
        }

        const deliveryDate = this.calculateDeliveryDate();
        this.dateValue.textContent = deliveryDate;
        this.result.classList.add('active');
      }

      calculateDeliveryDate() {
        const today = new Date();
        const currentHour = today.getHours();
        const currentMinute = today.getMinutes();
        
        let daysToAdd = {{ block.settings.delivery_days }};
        
        const cutoffHour = parseInt('{{ block.settings.cutoff_time }}'.split(':')[0]);
        const cutoffMinute = parseInt('{{ block.settings.cutoff_time }}'.split(':')[1]);
        
        if (currentHour > cutoffHour || (currentHour === cutoffHour && currentMinute >= cutoffMinute)) {
          daysToAdd += 1;
        }

        const deliveryDate = new Date(today);
        deliveryDate.setDate(deliveryDate.getDate() + daysToAdd);

        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

        const day = deliveryDate.getDate();
        const month = months[deliveryDate.getMonth()];
        const dayName = days[deliveryDate.getDay()];

        return day + ' ' + month + ', ' + dayName;
      }
    }

    customElements.define('delivery-checker-{{ ai_gen_id }}', DeliveryChecker{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Delivery checker",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Delivery"
    },
    {
      "type": "text",
      "id": "placeholder",
      "label": "Input placeholder",
      "default": "Enter your city"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Check"
    },
    {
      "type": "text",
      "id": "condition_text",
      "label": "Condition text",
      "default": "if ordered before 4:33 PM"
    },
    {
      "type": "text",
      "id": "error_message",
      "label": "Error message",
      "default": "Please enter a valid city in Bangladesh"
    },
    {
      "type": "header",
      "content": "Delivery settings"
    },
    {
      "type": "range",
      "id": "delivery_days",
      "min": 1,
      "max": 14,
      "step": 1,
      "label": "Delivery days",
      "default": 7
    },
    {
      "type": "text",
      "id": "cutoff_time",
      "label": "Order cutoff time",
      "default": "16:33",
      "info": "Format: HH:MM (24-hour)"
    },
    {
      "type": "header",
      "content": "Border"
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Border width",
      "default": 1
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#E0E0E0"
    },
    {
      "type": "color",
      "id": "hover_border_color",
      "label": "Hover border color",
      "default": "#CCCCCC"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Shadow"
    },
    {
      "type": "range",
      "id": "shadow_horizontal",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Horizontal offset",
      "default": -7
    },
    {
      "type": "range",
      "id": "shadow_vertical",
      "min": -20,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Vertical offset",
      "default": 1
    },
    {
      "type": "range",
      "id": "shadow_blur",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Blur radius",
      "default": 4
    },
    {
      "type": "range",
      "id": "shadow_opacity",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "label": "Shadow opacity",
      "default": 0
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "secondary_text_color",
      "label": "Secondary text",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "placeholder_color",
      "label": "Placeholder",
      "default": "#999999"
    },
    {
      "type": "color",
      "id": "success_color",
      "label": "Success",
      "default": "#00A341"
    },
    {
      "type": "color",
      "id": "error_color",
      "label": "Error",
      "default": "#D82C0D"
    },
    {
      "type": "header",
      "content": "Input style"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Border color",
      "default": "#DDDDDD"
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 4
    },
    {
      "type": "header",
      "content": "Button style"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Text",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Hover background",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 4
    },
    {
      "type": "header",
      "content": "Result style"
    },
    {
      "type": "color",
      "id": "result_bg_color",
      "label": "Background",
      "default": "#F0F9F4"
    },
    {
      "type": "color",
      "id": "error_bg_color",
      "label": "Error background",
      "default": "#FFF0F0"
    },
    {
      "type": "range",
      "id": "result_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 4
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 14,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 18
    }
  ],
  "presets": [
    {
      "name": "Delivery checker"
    }
  ]
}
{% endschema %}
