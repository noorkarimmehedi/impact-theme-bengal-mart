{% doc %}
  @prompt
    generate a mobile bottom menu for me 
{% enddoc %}

{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-mobile-bottom-menu-{{ ai_gen_id }} {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: {{ block.settings.menu_background }};
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 999;
    display: none;
  }

  @media screen and (max-width: 749px) {
    .ai-mobile-bottom-menu-{{ ai_gen_id }} {
      display: block;
    }
  }

  .ai-mobile-bottom-menu__container-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: {{ block.settings.menu_padding }}px 0;
    max-width: 100%;
  }

  .ai-mobile-bottom-menu__item-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: {{ block.settings.icon_color }};
    transition: all 0.3s ease;
    flex: 1;
    position: relative;
  }

  .ai-mobile-bottom-menu__item-{{ ai_gen_id }}:hover {
    color: {{ block.settings.icon_active_color }};
  }

  .ai-mobile-bottom-menu__item-{{ ai_gen_id }}.active {
    color: {{ block.settings.icon_active_color }};
  }

  .ai-mobile-bottom-menu__icon-{{ ai_gen_id }} {
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    margin-bottom: 4px;
    position: relative;
  }

  .ai-mobile-bottom-menu__icon-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    stroke: currentColor;
    fill: none;
    stroke-width: {{ block.settings.icon_stroke_width }};
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  .ai-mobile-bottom-menu__label-{{ ai_gen_id }} {
    font-size: {{ block.settings.label_size }}px;
    font-weight: 500;
    text-align: center;
  }

  .ai-mobile-bottom-menu__badge-{{ ai_gen_id }} {
    position: absolute;
    top: -4px;
    right: -8px;
    background-color: {{ block.settings.badge_background }};
    color: {{ block.settings.badge_text_color }};
    border-radius: 10px;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 600;
    padding: 0 4px;
  }
{% endstyle %}

<mobile-bottom-menu-{{ ai_gen_id }}
  class="ai-mobile-bottom-menu-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <nav class="ai-mobile-bottom-menu__container-{{ ai_gen_id }}">
    {% if block.settings.show_home %}
      <a
        href="{{ block.settings.home_link }}"
        class="ai-mobile-bottom-menu__item-{{ ai_gen_id }}"
        data-menu-item="home"
      >
        <div class="ai-mobile-bottom-menu__icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        </div>
        {% if block.settings.show_labels %}
          <span class="ai-mobile-bottom-menu__label-{{ ai_gen_id }}">{{ block.settings.home_label }}</span>
        {% endif %}
      </a>
    {% endif %}

    {% if block.settings.show_shop %}
      <a
        href="{{ block.settings.shop_link }}"
        class="ai-mobile-bottom-menu__item-{{ ai_gen_id }}"
        data-menu-item="shop"
      >
        <div class="ai-mobile-bottom-menu__icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
        </div>
        {% if block.settings.show_labels %}
          <span class="ai-mobile-bottom-menu__label-{{ ai_gen_id }}">{{ block.settings.shop_label }}</span>
        {% endif %}
      </a>
    {% endif %}

    {% if block.settings.show_search %}
      <a
        href="{{ block.settings.search_link }}"
        class="ai-mobile-bottom-menu__item-{{ ai_gen_id }}"
        data-menu-item="search"
      >
        <div class="ai-mobile-bottom-menu__icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        {% if block.settings.show_labels %}
          <span class="ai-mobile-bottom-menu__label-{{ ai_gen_id }}">{{ block.settings.search_label }}</span>
        {% endif %}
      </a>
    {% endif %}

    {% if block.settings.show_cart %}
      <a
        href="{{ routes.cart_url }}"
        class="ai-mobile-bottom-menu__item-{{ ai_gen_id }}"
        data-menu-item="cart"
      >
        <div class="ai-mobile-bottom-menu__icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <path d="M16 10a4 4 0 0 1-8 0"></path>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="ai-mobile-bottom-menu__badge-{{ ai_gen_id }}">{{ cart.item_count }}</span>
          {% endif %}
        </div>
        {% if block.settings.show_labels %}
          <span class="ai-mobile-bottom-menu__label-{{ ai_gen_id }}">{{ block.settings.cart_label }}</span>
        {% endif %}
      </a>
    {% endif %}

    {% if block.settings.show_account %}
      <a
        href="{{ routes.account_url }}"
        class="ai-mobile-bottom-menu__item-{{ ai_gen_id }}"
        data-menu-item="account"
      >
        <div class="ai-mobile-bottom-menu__icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        {% if block.settings.show_labels %}
          <span class="ai-mobile-bottom-menu__label-{{ ai_gen_id }}">{{ block.settings.account_label }}</span>
        {% endif %}
      </a>
    {% endif %}
  </nav>
</mobile-bottom-menu-{{ ai_gen_id }}>

<script>
  (function() {
    class MobileBottomMenu{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.setActiveMenuItem();
        this.updateCartBadge();
      }

      setActiveMenuItem() {
        const currentPath = window.location.pathname;
        const menuItems = this.querySelectorAll('.ai-mobile-bottom-menu__item-{{ ai_gen_id }}');

        menuItems.forEach(function(item) {
          const itemHref = item.getAttribute('href');
          if (itemHref && currentPath.includes(itemHref) && itemHref !== '/') {
            item.classList.add('active');
          } else if (itemHref === '/' && currentPath === '/') {
            item.classList.add('active');
          }
        });
      }

      updateCartBadge() {
        const self = this;
        document.addEventListener('cart:updated', function() {
          fetch('/cart.js')
            .then(function(response) {
              return response.json();
            })
            .then(function(cart) {
              const badge = self.querySelector('.ai-mobile-bottom-menu__badge-{{ ai_gen_id }}');
              const cartIcon = self.querySelector('[data-menu-item="cart"] .ai-mobile-bottom-menu__icon-{{ ai_gen_id }}');

              if (cart.item_count > 0) {
                if (badge) {
                  badge.textContent = cart.item_count;
                } else if (cartIcon) {
                  const newBadge = document.createElement('span');
                  newBadge.className = 'ai-mobile-bottom-menu__badge-{{ ai_gen_id }}';
                  newBadge.textContent = cart.item_count;
                  cartIcon.appendChild(newBadge);
                }
              } else {
                if (badge) {
                  badge.remove();
                }
              }
            });
        });
      }
    }

    customElements.define('mobile-bottom-menu-{{ ai_gen_id }}', MobileBottomMenu{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Mobile bottom menu",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Menu style"
    },
    {
      "type": "color",
      "id": "menu_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "menu_padding",
      "min": 8,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Padding",
      "default": 12
    },
    {
      "type": "header",
      "content": "Icons"
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 20,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Icon size",
      "default": 24
    },
    {
      "type": "range",
      "id": "icon_stroke_width",
      "min": 1,
      "max": 2,
      "step": 0.1,
      "unit": "px",
      "label": "Icon thickness",
      "default": 2
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon color",
      "default": "#677279"
    },
    {
      "type": "color",
      "id": "icon_active_color",
      "label": "Active icon color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Labels"
    },
    {
      "type": "checkbox",
      "id": "show_labels",
      "label": "Show labels",
      "default": true
    },
    {
      "type": "range",
      "id": "label_size",
      "min": 10,
      "max": 14,
      "step": 1,
      "unit": "px",
      "label": "Label size",
      "default": 11
    },
    {
      "type": "header",
      "content": "Badge"
    },
    {
      "type": "color",
      "id": "badge_background",
      "label": "Badge background",
      "default": "#ff0000"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge text",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Home"
    },
    {
      "type": "checkbox",
      "id": "show_home",
      "label": "Show home",
      "default": true
    },
    {
      "type": "text",
      "id": "home_label",
      "label": "Label",
      "default": "Home"
    },
    {
      "type": "url",
      "id": "home_link",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Shop"
    },
    {
      "type": "checkbox",
      "id": "show_shop",
      "label": "Show shop",
      "default": true
    },
    {
      "type": "text",
      "id": "shop_label",
      "label": "Label",
      "default": "Shop"
    },
    {
      "type": "url",
      "id": "shop_link",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Search"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search",
      "default": true
    },
    {
      "type": "text",
      "id": "search_label",
      "label": "Label",
      "default": "Search"
    },
    {
      "type": "url",
      "id": "search_link",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Cart"
    },
    {
      "type": "checkbox",
      "id": "show_cart",
      "label": "Show cart",
      "default": true
    },
    {
      "type": "text",
      "id": "cart_label",
      "label": "Label",
      "default": "Cart"
    },
    {
      "type": "header",
      "content": "Account"
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show account",
      "default": true
    },
    {
      "type": "text",
      "id": "account_label",
      "label": "Label",
      "default": "Account"
    }
  ],
  "presets": [
    {
      "name": "Mobile bottom menu"
    }
  ]
}
{% endschema %}
